noob_id: ingest-loop
noob_model: noob.tube.TubeSpecification
noob_version: 0.1.1.dev209+g1cafe61
input:
  frame:
    scope: process
    type: np.ndarray
  traces:
    scope: process
    type: np.ndarray
  footprints:
    scope: process
    type: np.ndarray
  overlaps:
    scope: process
    type: np.ndarray
  pix_stats:
    scope: process
    type: np.ndarray
  comp_stats:
    scope: process
    type: np.ndarray
  residuals:
    scope: process
    type: np.ndarray


nodes:
  trace_frame:
    type: cala.nodes.omf.traces.Tracer
    params:
      tol: 0.001
      max_iter: 100
    depends:
      - traces: input.traces
      - footprints: input.footprints
      - frame: input.frame
      - overlaps: input.overlaps
  pix_frame:
    type: cala.nodes.omf.pixel_stats.ingest_frame
    depends:
      - pixel_stats: input.pix_stats
      - frame: input.frame
      - new_traces: trace_frame.latest_trace
      - footprints: input.footprints
  comp_frame:
    type: cala.nodes.omf.component_stats.ingest_frame
    depends:
      - component_stats: input.comp_stats
      - frame: input.frame
      - new_traces: trace_frame.latest_trace
  footprints_frame:
    type: cala.nodes.omf.footprints.Footprinter
    params:
      max_iter: 5
      ratio_lb: 0.10
    depends:
      - footprints: input.footprints
      - pixel_stats: pix_frame.value
      - component_stats: comp_frame.value
  residual:
    type: cala.nodes.omf.residual.Residuer
    depends:
      - frame: input.frame
      - footprints: footprints_frame.footprints
      - traces: input.traces
      - residuals: input.residuals
  return:
    type: return
    depends:
      residual.std